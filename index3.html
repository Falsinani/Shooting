<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport"
  content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<title>Space Shuttle Blaster</title>

<style>
html,body{
  margin:0;padding:0;height:100%;
  background:#05070b;
  overflow:hidden;
  touch-action:none;
  -webkit-user-select:none;
  user-select:none
}
canvas{display:block;width:100vw;height:100vh}

#hud{
  position:fixed;top:0;left:0;right:0;
  display:flex;justify-content:space-between;
  padding:10px;
  color:#eaf2ff;
  font-family:system-ui;
  pointer-events:none;
  z-index:5
}
.chip{
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.15);
  border-radius:14px;
  padding:6px 10px;
  font-size:13px
}

#overlay{
  position:fixed;inset:0;
  display:flex;align-items:center;justify-content:center;
  background:rgba(0,0,0,.45);
  z-index:10
}
#card{
  width:min(520px,90vw);
  background:rgba(255,255,255,.1);
  border-radius:18px;
  padding:18px;
  text-align:center;
  color:#fff;
  backdrop-filter:blur(10px)
}
</style>
</head>

<body>

<canvas id="c"></canvas>

<div id="hud">
  <div class="chip">ðŸ’¥ <b id="score">0</b></div>
  <div class="chip">ðŸ”« <b id="weapon">NORMAL</b></div>
  <div class="chip">âš¡ <b id="energy">100</b>%</div>
</div>

<div id="overlay">
  <div id="card">
    <h2>ðŸš€ Space Shuttle Blaster</h2>
    <p>ðŸ‘† Ù„Ù…Ø³Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨<br>
    Ø§Ø³Ø­Ø¨ Ù„Ù„ØªØ­Ø±Ùƒ â€” Ø¥Ø·Ù„Ø§Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠ</p>
    <p style="opacity:.7">Ø§Ù„ØµÙˆØª ÙŠØ¹Ù…Ù„ Ø¨Ø¹Ø¯ Ø£ÙˆÙ„ Ù„Ù…Ø³Ø© (iPhone)</p>
  </div>
</div>

<script>
(() => {

const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
let W,H,DPR;

function resize(){
  DPR = Math.min(2, devicePixelRatio || 1);
  W = innerWidth; H = innerHeight;
  canvas.width = W*DPR; canvas.height = H*DPR;
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
addEventListener("resize", resize);
resize();

/* ========= Audio unlock (iOS) ========= */
let audioCtx, unlocked=false;
function unlockAudio(){
  if(unlocked) return;
  const AC = window.AudioContext||webkitAudioContext;
  if(!AC) return;
  audioCtx = new AC();
  const b = audioCtx.createBuffer(1,1,audioCtx.sampleRate);
  const s = audioCtx.createBufferSource();
  s.buffer=b; s.connect(audioCtx.destination); s.start();
  unlocked=true;
}
function sfx(){
  if(!audioCtx) return;
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.frequency.value=200;
  g.gain.value=.05;
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+.1);
}

/* ========= Game state ========= */
const STATE={MENU:0,PLAY:1};
let state=STATE.MENU;

const player={x:W/2,y:H-80,targetX:W/2};
let bullets=[], asteroids=[];
let score=0, energy=100;

const overlay=document.getElementById("overlay");
const elScore=scoreEl=document.getElementById("score");
const elEnergy=document.getElementById("energy");
const elWeapon=document.getElementById("weapon");

/* ========= Game logic ========= */
function startGame(){
  bullets=[]; asteroids=[];
  score=0; energy=100;
  elScore.textContent=0;
  elEnergy.textContent=100;
  elWeapon.textContent="NORMAL";
  state=STATE.PLAY;
  overlay.style.display="none";
}

function spawnAsteroid(){
  asteroids.push({
    x:Math.random()*W,
    y:-40,
    r:20+Math.random()*20,
    vy:120+Math.random()*80
  });
}

function shoot(){
  bullets.push({x:player.x,y:player.y-20,vy:-500});
  sfx();
}

let shootCD=0, spawnCD=0;
let last=performance.now();

function loop(t){
  const dt=Math.min(.033,(t-last)/1000);
  last=t;

  ctx.fillStyle="#05070b";
  ctx.fillRect(0,0,W,H);

  if(state===STATE.PLAY){

    player.x += (player.targetX-player.x)*0.15;

    shootCD-=dt;
    if(shootCD<=0){
      shootCD=.18;
      shoot();
    }

    spawnCD-=dt;
    if(spawnCD<=0){
      spawnCD=.6;
      spawnAsteroid();
    }

    bullets.forEach(b=>b.y+=b.vy*dt);
    bullets=bullets.filter(b=>b.y>-50);

    asteroids.forEach(a=>a.y+=a.vy*dt);
    asteroids=asteroids.filter(a=>a.y<H+60);

    for(let a of asteroids){
      for(let b of bullets){
        const dx=a.x-b.x, dy=a.y-b.y;
        if(dx*dx+dy*dy<a.r*a.r){
          score++; elScore.textContent=score;
          a.y=H+100; b.y=-100;
        }
      }
    }
  }

  // draw
  ctx.fillStyle="#fff";
  ctx.beginPath();
  ctx.moveTo(player.x,player.y-20);
  ctx.lineTo(player.x+10,player.y+20);
  ctx.lineTo(player.x-10,player.y+20);
  ctx.fill();

  ctx.fillStyle="#f33";
  asteroids.forEach(a=>{
    ctx.beginPath();
    ctx.arc(a.x,a.y,a.r,0,Math.PI*2);
    ctx.fill();
  });

  ctx.fillStyle="#0ff";
  bullets.forEach(b=>{
    ctx.fillRect(b.x-2,b.y-8,4,12);
  });

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ========= INPUT (Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ) ========= */
document.addEventListener("pointerdown", e=>{
  unlockAudio();
  if(state===STATE.MENU){
    startGame();
  }
  player.targetX=e.clientX;
},{passive:false});

document.addEventListener("pointermove", e=>{
  if(state===STATE.PLAY){
    player.targetX=e.clientX;
  }
},{passive:false});

})();
</script>
</body>
</html>
